<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Doom Inspired First-Person</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  canvas { display:block; margin:0 auto; background:#333; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="400"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const map = [
  [1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,1,1,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1]
];

const TILE = 64;
const FOV = Math.PI / 3; // 60 degrees
const NUM_RAYS = canvas.width / 2;

const player = {
  x: TILE * 1.5,
  y: TILE * 1.5,
  angle: 0,
  speed: 2
};

// Controls
const keys = {};
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

function castRays() {
  const rays = [];
  const startAngle = player.angle - FOV/2;

  for(let i=0; i<NUM_RAYS; i++){
    const rayAngle = startAngle + (i/NUM_RAYS)*FOV;
    let distance = 0;
    let hit = false;
    let hitX, hitY;
    
    while(!hit && distance < 800){
      distance += 1;
      const x = player.x + Math.cos(rayAngle)*distance;
      const y = player.y + Math.sin(rayAngle)*distance;
      const mapX = Math.floor(x/TILE);
      const mapY = Math.floor(y/TILE);
      if(map[mapY] && map[mapY][mapX] > 0){
        hit = true;
        hitX = x;
        hitY = y;
      }
    }

    rays.push({distance, hitX, hitY, angle: rayAngle});
  }
  return rays;
}

function updatePlayer() {
  if(keys['ArrowUp']){
    player.x += Math.cos(player.angle)*player.speed;
    player.y += Math.sin(player.angle)*player.speed;
  }
  if(keys['ArrowDown']){
    player.x -= Math.cos(player.angle)*player.speed;
    player.y -= Math.sin(player.angle)*player.speed;
  }
  if(keys['ArrowLeft']) player.angle -= 0.03;
  if(keys['ArrowRight']) player.angle += 0.03;
}

function draw() {
  ctx.fillStyle = '#333';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const rays = castRays();
  for(let i=0; i<rays.length; i++){
    const ray = rays[i];
    const correctedDistance = ray.distance * Math.cos(ray.angle - player.angle);
    const wallHeight = (TILE*canvas.height)/correctedDistance;

    ctx.fillStyle = `rgb(${255- correctedDistance*0.5},0,0)`;
    ctx.fillRect(i*2, canvas.height/2 - wallHeight/2, 2, wallHeight);
  }
}

function gameLoop() {
  updatePlayer();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
