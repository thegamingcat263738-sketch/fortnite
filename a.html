<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Doom-Inspired FPS</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  canvas { display:block; margin:0 auto; background:#333; }
  #info { position:absolute; top:10px; left:10px; color:white; font-family:monospace; }
</style>
</head>
<body>
<div id="info">Health: <span id="health">100</span></div>
<canvas id="gameCanvas" width="800" height="400"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const healthDisplay = document.getElementById('health');

// MAP: 1 = wall, 0 = empty
const map = [
  [1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,1,1,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1]
];

const TILE = 64;
const FOV = Math.PI / 3;
const NUM_RAYS = canvas.width / 2;

const player = { x:TILE*1.5, y:TILE*1.5, angle:0, speed:2, health:100, bullets:[] };

// Enemy setup
const enemies = [
  { x:TILE*7, y:TILE*2, width:20, height:20, color:'green', speed:1 }
];

// Controls
const keys = {};
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

// Shooting
canvas.addEventListener('click', e => {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  const angle = Math.atan2(mouseY - canvas.height/2, mouseX - canvas.width/2);
  player.bullets.push({ x:player.x, y:player.y, dx: Math.cos(angle)*5, dy: Math.sin(angle)*5 });
});

function castRays() {
  const rays = [];
  const startAngle = player.angle - FOV/2;
  for(let i=0; i<NUM_RAYS; i++){
    const rayAngle = startAngle + (i/NUM_RAYS)*FOV;
    let distance = 0;
    let hit = false;
    while(!hit && distance < 800){
      distance += 1;
      const x = player.x + Math.cos(rayAngle)*distance;
      const y = player.y + Math.sin(rayAngle)*distance;
      const mapX = Math.floor(x/TILE);
      const mapY = Math.floor(y/TILE);
      if(map[mapY] && map[mapY][mapX] > 0) hit = true;
    }
    rays.push({distance, angle:rayAngle});
  }
  return rays;
}

function updatePlayer() {
  let moveX=0, moveY=0;
  if(keys['w']) { moveX += Math.cos(player.angle)*player.speed; moveY += Math.sin(player.angle)*player.speed; }
  if(keys['s']) { moveX -= Math.cos(player.angle)*player.speed; moveY -= Math.sin(player.angle)*player.speed; }
  if(keys['a']) { moveX += Math.cos(player.angle - Math.PI/2)*player.speed; moveY += Math.sin(player.angle - Math.PI/2)*player.speed; }
  if(keys['d']) { moveX += Math.cos(player.angle + Math.PI/2)*player.speed; moveY += Math.sin(player.angle + Math.PI/2)*player.speed; }

  // Collision with walls
  const nextX = player.x + moveX;
  const nextY = player.y + moveY;
  if(map[Math.floor(player.y/TILE)][Math.floor(nextX/TILE)] == 0) player.x = nextX;
  if(map[Math.floor(nextY/TILE)][Math.floor(player.x/TILE)] == 0) player.y = nextY;

  if(keys['ArrowLeft']) player.angle -= 0.03;
  if(keys['ArrowRight']) player.angle += 0.03;
}

function updateBullets() {
  player.bullets.forEach((b,i) => {
    b.x += b.dx;
    b.y += b.dy;
    // Remove bullets out of bounds
    if(b.x<0 || b.x>canvas.width || b.y<0 || b.y>canvas.height) player.bullets.splice(i,1);

    // Collision with enemies
    enemies.forEach((e,j) => {
      if(Math.hypot(b.x-e.x, b.y-e.y)<20){
        enemies.splice(j,1);
        player.bullets.splice(i,1);
      }
    });
  });
}

function updateEnemies() {
  enemies.forEach(e => {
    const dx = player.x - e.x;
    const dy = player.y - e.y;
    const dist = Math.hypot(dx, dy);
    if(dist>0){
      e.x += (dx/dist)*e.speed;
      e.y += (dy/dist)*e.speed;
    }

    // Collision with player
    if(dist<20){
      player.health -= 0.5;
      healthDisplay.textContent = Math.max(0, Math.floor(player.health));
    }
  });
}

function draw() {
  ctx.fillStyle = '#333';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Draw 3D walls
  const rays = castRays();
  for(let i=0;i<rays.length;i++){
    const ray = rays[i];
    const correctedDistance = ray.distance * Math.cos(ray.angle - player.angle);
    const wallHeight = (TILE*canvas.height)/correctedDistance;
    ctx.fillStyle = `rgb(${255- correctedDistance*0.5},0,0)`;
    ctx.fillRect(i*2, canvas.height/2 - wallHeight/2, 2, wallHeight);
  }

  // Draw enemies (as simple red squares)
  enemies.forEach(e => {
    ctx.fillStyle = e.color;
    const dx = e.x - player.x;
    const dy = e.y - player.y;
    const angleToEnemy = Math.atan2(dy, dx) - player.angle;
    const distance = Math.hypot(dx, dy);
    const enemyHeight = (TILE*canvas.height)/distance;
    const enemyX = canvas.width/2 + Math.tan(angleToEnemy)*canvas.width/2 - 10;
    ctx.fillRect(enemyX, canvas.height/2 - enemyHeight/2, 20, enemyHeight);
  });

  // Draw bullets
  ctx.fillStyle = 'yellow';
  player.bullets.forEach(b => ctx.fillRect(b.x-2,b.y-2,4,4));
}

function gameLoop() {
  updatePlayer();
  updateBullets();
  updateEnemies();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
